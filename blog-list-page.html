<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“„ HYL ë¸”ë¡œê·¸ ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
      text-align: center;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #f7f7f7;
    }
    .new {
      color: red;
      font-weight: bold;
    }
    .status-label {
      display: inline-block;
      padding: 4px 8px;
      font-size: 13px;
      border-radius: 4px;
      margin-left: 6px;
    }
    .status-ê²€ìˆ˜ëŒ€ê¸° {
      background: #fff3cd;
      color: #856404;
    }
    .status-ë³€í™˜ì¤‘ {
      background: #cce5ff;
      color: #004085;
    }
    .status-ì™„ë£Œ {
      background: #d4edda;
      color: #155724;
    }

    /* ê³µí†µ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .method-label {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid rgba(0,0,0,0.06);
      background: #f0f0f0;
      color: #424242;
      line-height: 1;
      vertical-align: middle;
    }
    /* âœ… ì„ íƒì§€ë³„ ìƒ‰ìƒ ë§¤í•‘ (ìµœì¢… ì„¸íŠ¸) */
    .method-ì •ë³´ì„± { background:#e6f3ff; color:#0b5cab; }   /* íŒŒë€ ê³„ì—´ */
    .method-ì–‘ì‹ê¸€ { background:#fff0da; color:#8a5a00; }   /* ì£¼í™© ê³„ì—´ */
    .method-ì´ë¯¸ì§€ { background:#e0f7f7; color:#006d6d; }   /* ë¯¼íŠ¸ ê³„ì—´ */
    .method-ë¦¬ë·°ê¸€ { background:#efe3f7; color:#6a1b9a; }   /* ë³´ë¼ ê³„ì—´ */
    .method-ë³´ë„ê¸€ { background:#e8f5e9; color:#2e7d32; }   /* ì´ˆë¡ ê³„ì—´ */
    .method-ì¶œì²˜ê¸€ { background:#fde7ef; color:#ad1457; }   /* í•‘í¬ ê³„ì—´ */
    .method-default { background:#eeeeee; color:#424242; }  /* ê¸°ë³¸ */
  </style>
</head>
<body>
  <h2>ğŸ“„ HYL ë¸”ë¡œê·¸ ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸</h2>
  <table id="post-table">
    <thead>
      <tr>
        <th>ìˆœë²ˆ</th>
        <th>ì œëª©</th>
        <th>í¬ìŠ¤íŠ¸ ìƒì„±ì¼</th>
        <th>ìƒì„± ë°©ì‹</th>
        <th>ì—´ëŒ ì—¬ë¶€</th>
      </tr>
    </thead>
    <tbody id="table-body">
      <tr><td colspan="5">â³ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...</td></tr>
    </tbody>
  </table>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const company = urlParams.get("company");

    const proxyEndpoint = "https://hyltest-airtable-content-list.mktg-95f.workers.dev/";
    const tableBody = document.getElementById("table-body");

    // âœ… ìµœì¢… ë§¤í•‘ ì„¸íŠ¸: 'ìƒì„± ë°©ì‹' â†’ CSS í´ë˜ìŠ¤
    const METHOD_CLASS_MAP = {
      "ì •ë³´ì„±": "method-ì •ë³´ì„±",
      "ì–‘ì‹ê¸€": "method-ì–‘ì‹ê¸€",
      "ì´ë¯¸ì§€": "method-ì´ë¯¸ì§€",
      "ë¦¬ë·°ê¸€": "method-ë¦¬ë·°ê¸€",
      "ë³´ë„ê¸€": "method-ë³´ë„ê¸€",
      "ì¶œì²˜ê¸€": "method-ì¶œì²˜ê¸€",
    };

    // í˜¹ì‹œ cellFormat=jsonìœ¼ë¡œ ë°”ë€Œì–´ {name:"..."} í˜•íƒœê°€ ì˜¬ ë•Œë¥¼ ëŒ€ë¹„
    const getMethodName = (raw) => {
      if (!raw) return "-";
      if (typeof raw === "string") return raw;
      if (typeof raw === "object" && raw.name) return raw.name;
      return String(raw);
    };

    if (!company) {
      tableBody.innerHTML = `<tr><td colspan="5" style="color:red">âŒ URLì— company íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    } else {
      const url = `${proxyEndpoint}?company=${encodeURIComponent(company)}`;

      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error("í”„ë¡œí‚¤ ì‘ë‹µ ì‹¤íŒ¨");
          return res.json();
        })
        .then(data => {
          tableBody.innerHTML = "";

          if (!data.records || data.records.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="5">ğŸ“ í‘œì‹œí•  ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            return;
          }

          data.records.forEach((record, index) => {
            const fields = record.fields;
            const title = fields["ì½˜í…ì¸  ì œëª©"] || "-";
            const postId = fields["post_id"] || "-";
            const createdDate = postId.length >= 8 ? `${postId.slice(0, 4)}-${postId.slice(4, 6)}-${postId.slice(6, 8)}` : "-";
            const status = fields["ìƒíƒœ"] || "ê²€ìˆ˜ ëŒ€ê¸°";

            // âœ… ìƒì„± ë°©ì‹ ì²˜ë¦¬(ë§¤í•‘ ì ìš©)
            const methodName = getMethodName(fields["ìƒì„± ë°©ì‹"]);
            const methodClass = METHOD_CLASS_MAP[methodName] || "method-default";

            let statusLabel = "";
            if (status === "ê²€ìˆ˜ ëŒ€ê¸°") {
              statusLabel = `<span class="status-label status-ê²€ìˆ˜ëŒ€ê¸°">ê²€ìˆ˜ ëŒ€ê¸°</span>`;
            } else if (status === "ë³€í™˜ì¤‘") {
              statusLabel = `<span class="status-label status-ë³€í™˜ì¤‘">ê²€ìˆ˜ ì™„ë£Œ</span>`;
            } else if (status === "ì™„ë£Œ") {
              statusLabel = `<span class="status-label status-ì™„ë£Œ">ì—…ë¡œë“œ ì™„ë£Œ</span>`;
            }

            const viewedKey = `viewed_${company}_${postId}`;
            const isViewed = localStorage.getItem(viewedKey) === "true";
            const viewedLabel = isViewed ? "ì—´ëŒë¨" : "<span class='new'>new!</span>";

            const link = `index.html?company=${encodeURIComponent(company)}&post_id=${encodeURIComponent(postId)}`;

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${index + 1}</td>
              <td><a href="${link}">${title}</a></td>
              <td>${createdDate}</td>
              <td><span class="method-label ${methodClass}">${methodName}</span></td>
              <td>${viewedLabel} ${statusLabel}</td>
            `;
            tableBody.appendChild(row);
          });
        })
        .catch(error => {
          console.error(error);
          tableBody.innerHTML = `<tr><td colspan="5">âš ï¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</td></tr>`;
        });
    }
  </script>
</body>
</html>
